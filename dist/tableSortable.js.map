{"version":3,"file":"tableSortable.js","sources":["tableSortable.esm.js"],"sourcesContent":["/**\n * A simple jQuery plugin to sort table body by a selected column\n *\n * @license MIT\n * @author Dumitru Uzun (DUzun.Me)\n * @version 1.0.0\n */\nexport default function initTableSortable($) {\n    const CLICK_TH_SELECTOR = 'th:not(.nosort),td.sort';\n    let sort_dir;\n    const tableSortable = function tableSortable() {\n        // Mark the table as initialized\n        this.addClass('table_sortable');\n        let $thead = this.children('thead');\n        let $tbody = this.children('tbody');\n        let $thr = $thead.children('tr');\n        $thead.on('click', CLICK_TH_SELECTOR, function () {\n            const $th = $(this);\n            let sortOrder = $th.hasClass('asc') ? -1 : 1;\n            const $ths = $thr.children(CLICK_TH_SELECTOR);\n            $ths.removeClass('asc desc');\n            if (sortOrder === -1) {\n                $th.removeClass('asc').addClass('desc');\n            }\n            else {\n                $th.removeClass('desc').addClass('asc');\n            }\n            let cols = $th.data('_cols_');\n            if (cols == undefined) {\n                calcCols($thr);\n                cols = $th.data('_cols_');\n            }\n            const rows = $tbody.find('>tr:has(td)')\n                .get() // get an Array\n                .map((tr) => {\n                const $tds = $(tr).children('td');\n                const ret = cols.map(function (col) {\n                    let val = $tds.eq(col).text().toUpperCase(); // ignore case\n                    let ret = [val];\n                    let num = parseFloat(val.trim());\n                    if (!isNaN(num))\n                        ret[1] = num;\n                    return ret;\n                });\n                ret.tr = tr;\n                return ret;\n            });\n            sort_dir = sortOrder;\n            rows.sort(cmpArr);\n            $tbody.append(rows.map((row) => row.tr));\n        });\n        return this;\n    };\n    // Comparison function for [].sort(), almost like narutal sort\n    function cmpArr(_a, _b) {\n        let ret;\n        _a.some((a, idx) => {\n            let b = _b[idx];\n            if (1 in a && 1 in b && (ret = a[1] - b[1])) {\n                return ret;\n            }\n            else {\n                let val1 = a[0];\n                let val2 = b[0];\n                if (val1 != val2) {\n                    ret = val1 < val2 ? -1 : 1;\n                    return ret;\n                }\n            }\n        });\n        return ret * (sort_dir > 0 ? 1 : -1);\n    }\n    // Calc _cols_ indexes, respecting colspan and rowspan in headers\n    function calcCols($thr) {\n        let headerMatrix = [];\n        $thr.each((rowIdx, tr) => {\n            $(tr)\n                .children('th,td')\n                .each((colIdx, td) => {\n                //@ts-ignore\n                let { rowSpan, colSpan } = td;\n                const cols = [];\n                const colsDict = {};\n                while (rowSpan-- > 0) {\n                    let _rowIdx = rowIdx + rowSpan;\n                    let _colSpan = colSpan;\n                    while (_colSpan-- > 0) {\n                        let _colIdx = colIdx + _colSpan;\n                        let rowMatrix = headerMatrix[_rowIdx] || (headerMatrix[_rowIdx] = []);\n                        while (rowMatrix[_colIdx])\n                            ++_colIdx;\n                        rowMatrix[_colIdx] = td;\n                        if (!(_colIdx in colsDict)) {\n                            cols.push(_colIdx);\n                            colsDict[_colIdx] = _colIdx;\n                        }\n                    }\n                }\n                cols.sort();\n                $(td).data('_cols_', cols);\n            });\n        });\n    }\n    $.fn.tableSortable = tableSortable;\n    return tableSortable;\n}\n// Auto-init in browser when jQuery or Zepto is present\nif (typeof window !== 'undefined') {\n    const $ = window.jQuery || window.Zepto;\n    if ($) {\n        initTableSortable($);\n    }\n}\n"],"names":["initTableSortable","$","CLICK_TH_SELECTOR","sort_dir","tableSortable","addClass","$thead","children","$tbody","$thr","on","$th","sortOrder","hasClass","$ths","removeClass","cols","data","undefined","calcCols","rows","find","get","map","tr","$tds","ret","col","val","eq","text","toUpperCase","num","parseFloat","trim","isNaN","sort","cmpArr","append","row","_a","_b","some","a","idx","b","val1","val2","headerMatrix","each","rowIdx","colIdx","td","rowSpan","colSpan","colsDict","_rowIdx","_colSpan","_colIdx","rowMatrix","push","fn","window","jQuery","Zepto"],"mappings":"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"}